# Kameleoon .NET Starter Kit

> The Kameleoon .NET Starter Kit demonstrates Kameleoon experimentation and feature flags.

This repository is home to the Kameleoon starter kit for .NET. Kameleoon is a powerful experimentation and personalization platform for product teams that enables you to make insightful discoveries by testing the features on your roadmap. Discover more at https://kameleoon.com, or see the [developer documentation](https://developers.kameleoon.com).

## Using the Starter Kit

This starter kit provides quickstart instructions for developers using the [Kameleoon .NET SDK](https://developers.kameleoon.com/feature-management-and-experimentation/web-sdks/csharp-sdk/).

### Prerequisites

Make sure you have the following requirements before you get started:

1. A Kameleoon user account. Visit [kameleoon.com](https://www.kameleoon.com/) to learn more.
2. Have the `.NET 7.0` (or later) installed.

### Get started

To get started, follow these steps:

1. Clone the repository and move into the `StarterKit/` directory:

```bash
git clone git@github.com:Kameleoon/dotnet-examples.git
cd dotnet-examples/StarterKit
```

2. In the `appsettings.json` file, set your `ClientId`, `ClientSecret`, and `SiteCode`. To start the server locally, leave `TopLevelDomain` as `localhost`. If you want to deploy on remote server, set the `TopLevelDomain` to your actual top-level domain:

```json
"Kameleoon": {
    "SiteCode": "siteCode",
    "ClientId": "clientId",
    "ClientSecret": "clientSecret",
    "TopLevelDomain": "localhost"
}
```

3. Run the server. By default, the server runs locally on port `4300`:

```bash
dotnet run
```

### Usage

> [Swagger](http://localhost:4300/swagger) is available.

1. After the server starts, you can fetch the variation of a visitor code that's generated by the SDK by visiting a URL:
```
http://localhost:4300/Variation?featureKey=<featureKey>
```

2. If you need to reset the visitor code, delete the `kameleoonVisitorCode` cookie for `localhost` in your browser.

## How it works

### Initialization

Copy the initialization code snippet found in the `Program.cs` file into your own code. Make sure you properly handle the possible exceptions.

```csharp
try
{
    var config = new KameleoonClientConfig("clientId", "clientSecret", topLevelDomain: "localhost");
    var client = KameleoonClientFactory.Create("siteCode", config);
    await client.WaitInit();
}
// Handle Kameleoon exceptions
catch (KameleoonException exception)
{
    if (exception is KameleoonException.ConfigCredentialsInvalid ||
        exception is KameleoonException.SiteCodeIsEmpty)
    {
        Console.WriteLine($"Expected KameleoonException: {exception}");
    }
    else
        Console.WriteLine($"Unexpected KameleoonException: {exception.Message}");
}
```

### Getting the visitor code

To get the visitor code, provide the `HttpContext.Request` and `HttpContext.Response` values to the `GetVisitorCode` method. The SDK will check the cookies for an existing visitor code. If a visitor code is not found, the SDK generates a new visitor code.

```csharp
var visitorCode = _kameleoonClient.GetVisitorCode(HttpContext.Request, HttpContext.Response);
```

### Get variation

To get the variation assigned to the visitor, call `GetFeatureVariationKey` with the `visitorCode` and `featureKey`. Make sure you handle the possible exceptions.

```csharp
var visitorCode = _kameleoonClient.GetVisitorCode(HttpContext.Request, HttpContext.Response);
try
{
    var variationKey = _kameleoonClient.GetFeatureVariationKey(visitorCode, featureKey);
    return new Response()
    {
        VisitorCode = visitorCode,
        VariationKey = variationKey
    };
}
catch (KameleoonException exception)
{
    if (exception is KameleoonException.VisitorCodeInvalid ||
        exception is KameleoonException.FeatureNotFound ||
        exception is KameleoonException.FeatureEnvironmentDisabled)
    {
        _logger.LogError(exception, "Expected KameleoonException");
    }
    else
        _logger.LogError(exception, "Unexpected KameleoonException");
}
catch (Exception exception)
{
    _logger.LogError(exception, "Unexpected Exception");
}
```
